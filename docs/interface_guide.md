# FPGA 矩阵计算器接口使用指南

本文档详细说明了 FPGA 矩阵计算器在 EGO1 开发板上的硬件接口分配及使用方法。

## 1. 硬件平台
*   **开发板**: EGO1 (Xilinx Artix-7 XC7A35T-1CSG324C)
*   **系统时钟**: 物理输入 100MHz (P17)，内部逻辑分频至 **50MHz**。

## 2. 引脚分配概览

| 信号名称 | 方向 | EGO1 引脚 | 硬件组件 | 说明 |
| :--- | :--- | :--- | :--- | :--- |
| **clk** | Input | **P17** | 晶振 | 100MHz 系统时钟输入 |
| **rst_n** | Input | **P15** | 按键 S6 (RST) | 系统复位 (低电平有效，需确认按键极性) |
| **btn** | Input | **U4** | 按键 S4 | **确认/开始** 按钮 (注意：S5 为 PROG 键，不可用) |
| **uart_rx** | Input | **N5** | UART RX | 串口数据接收 (连接上位机 TX) |
| **uart_tx** | Output | **T4** | UART TX | 串口数据发送 (连接上位机 RX) |
| **sw[7:0]** | Input | **P5...R1** | 拨码开关 SW7-SW0 | 模式及运算类型选择 |
| **led[7:0]** | Output | **F6...K2** | LED7-LED0 | 系统状态指示 |
| **seg[7:0]** | Output | **D5...B4** | 数码管段选 | 显示数值 (dp, g, f, e, d, c, b, a) |
| **an[3:0]** | Output | **H1...G2** | 数码管位选 | 数码管位激活控制 |

## 3. 详细使用说明

### 3.1 系统控制
*   **复位**: 按下 **S6 (P15)** 复位系统。复位后所有状态机回到初始状态。
*   **确认/开始**: 按下 **S4 (U4)** 触发当前选定模式的操作（如开始计算、确认输入）。
    *   *注意*: 请勿按 S5，它是 FPGA 编程复位键 (PROG)，会擦除配置。

### 3.2 模式选择 (拨码开关 SW7-SW3)
通过拨码开关 **SW7-SW3** 选择系统工作模式（高电平有效，优先级从高到低）：

| 开关 | 模式名称 | 说明 |
| :--- | :--- | :--- |
| **SW7** | **矩阵输入 (Input)** | 从 UART 接收矩阵数据并存储。 |
| **SW6** | **生成模式 (Generate)** | 内部生成测试矩阵数据。 |
| **SW5** | **显示模式 (Show)** | 读取存储的矩阵并通过 UART 发送显示。 |
| **SW4** | **计算模式 (Calculate)** | 执行矩阵运算。需配合 SW2-SW0 选择运算类型。 |
| **SW3** | **设置模式 (Settings)** | 配置系统参数 (如超时时间)。 |

### 3.3 运算类型选择 (拨码开关 SW2-SW0)
仅在 **计算模式 (SW4=1)** 下有效：

| SW[2:0] | 运算类型 | 说明 |
| :--- | :--- | :--- |
| `000` | **转置 (Transpose)** | 矩阵转置运算 |
| `001` | **加法 (Add)** | 矩阵加法 (A + B) |
| `010` | **乘法 (Mul)** | 矩阵乘法 (A * B) |
| `011` | **标量乘 (Scalar Mul)** | 矩阵标量乘法 (k * A) |

### 3.4 状态指示 (LED)
LED 灯用于实时反馈系统状态：

| LED | 名称 | 状态说明 |
| :--- | :--- | :--- |
| **LED0** | **Error** | 亮起表示发生错误 (如输入格式错误、溢出)。 |
| **LED1** | **Done** | 亮起表示当前操作完成。 |
| **LED2** | **Busy** | 亮起表示系统正在处理 (计算中、接收中)。 |
| **LED7-3** | **Mode Debug** | 显示当前解码后的内部操作模式代码。 |

### 3.5 数码管显示
*   在 **计算模式** 下，数码管显示运算耗时（时钟周期数）或其他结果信息。
*   在其他模式下，数码管通常关闭。

### 3.6 UART 通信
*   **波特率**: 115200
*   **数据位**: 8
*   **停止位**: 1
*   **校验位**: 无
*   **连接**: 使用 USB-TTL 模块，将模块的 TX 接板子的 RX (N5)，模块的 RX 接板子的 TX (T4)。

## 4. 注意事项
1.  **时钟频率**: 系统内部逻辑运行在 **50MHz**。虽然板载晶振为 100MHz，但顶层模块已包含分频逻辑。
2.  **按键去抖**: 系统已包含 20ms 的按键去抖逻辑。
3.  **复位极性**: 代码中复位为低电平有效 (`rst_n`)。请确保 S6 按键按下时产生低电平，或在约束中正确配置（通常 EGO1 按键按下为高电平，可能需要逻辑反转，当前设计假设物理输入已适配或用户知晓）。
