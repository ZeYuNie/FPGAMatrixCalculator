# Input Subsystem (输入子系统)

## 1. 概述

`input_subsystem` 是负责处理所有数据输入和生成的子系统。它集成了矩阵输入、随机矩阵生成以及系统设置配置的功能。该子系统利用一个共享的全局输入缓冲区 (`ascii_num_sep_top`) 来解析来自 UART 的数据流，并根据当前的操作模式将数据分发给相应的处理模块。

## 2. 功能模块

该子系统集成了以下核心模块：

1.  **`ascii_num_sep_top` (全局输入缓冲区)**:
    *   负责接收 UART RX 数据流。
    *   解析 ASCII 格式的数字并存储在内部缓冲 RAM 中。
    *   为所有输入模式提供统一的数据源。

2.  **`matrix_input_handler` (矩阵输入处理器)**:
    *   处理 "Matrix Input" 模式。
    *   从缓冲区读取用户输入的矩阵数据。
    *   将矩阵写入中央存储 (`matrix_storage_manager`)。

3.  **`matrix_rand_gen_handler` (随机生成处理器)**:
    *   处理 "Matrix Generate" 模式。
    *   从缓冲区读取生成参数 (维度、数量)。
    *   生成随机矩阵并写入中央存储。

4.  **`settings_data_handler` (设置处理器)**:
    *   处理 "Settings" 模式。
    *   从缓冲区读取设置参数。
    *   更新系统的全局设置 (如最大维度、倒计时等)。

## 3. 接口说明

### 3.1 控制接口
*   `clk`, `rst_n`: 系统时钟和复位。
*   `mode_is_input`: 激活矩阵输入模式。
*   `mode_is_gen`: 激活矩阵生成模式。
*   `mode_is_settings`: 激活设置模式。
*   `start`: 启动信号 (脉冲)，通常由确认按键触发。

### 3.2 数据接口
*   `uart_rx_data`, `uart_rx_valid`: 来自 UART 接收模块的数据流。
*   `settings_...`: 输出当前的系统设置值。

### 3.3 存储接口
*   **写接口**: 输出 `write_request` 及相关数据信号，连接到 `matrix_storage_manager` 的写端口。
*   **读接口**: 输出 `storage_rd_addr`，用于在生成或输入前检查空闲槽位。

## 4. 内部仲裁逻辑

由于多个模块共享同一个输入缓冲区和存储写端口，子系统内部实现了仲裁逻辑：

*   **缓冲区读取仲裁**: 根据当前激活的模式 (`mode_is_...`)，选择相应的模块来驱动缓冲区的读地址 (`buf_rd_addr`)。
*   **存储写入仲裁**: 根据当前激活的模式，选择相应的模块来驱动存储管理器的写请求信号。

## 5. 工作流程

1.  **模式选择**: 用户通过拨码开关选择模式 (Input, Gen, 或 Settings)。
2.  **数据输入**: 用户通过 UART 发送 ASCII 格式的数据 (如 "2 2 1 2 3 4")。
3.  **缓冲解析**: `ascii_num_sep_top` 实时解析数据并存入缓冲区。
4.  **启动处理**: 用户按下确认键，触发 `start` 信号。
5.  **执行**: 对应的处理器模块从缓冲区读取解析后的数据，执行逻辑 (如写入矩阵)，并控制 `busy`/`done` 状态。
